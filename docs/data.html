---

title: snkrfinder.data

keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/01a_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01a_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a cool reference for a fastai VAE
<a href="https://medium.com/@dhuynh95/an-introduction-to-unsupervised-learning-with-fastai-a6dbd78eca2b">https://medium.com/@dhuynh95/an-introduction-to-unsupervised-learning-with-fastai-a6dbd78eca2b</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First we need to get a database of sneaker images.   The sneaker images are only 136 pixels wide, and organized by 'Category', 'SubCategory', and 'Brand'.   Additional semantic information is also available from Mechanical Turk labeling, and is available packed into matlab files.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Part-0:-DATA">Part 0: DATA<a class="anchor-link" href="#Part-0:-DATA"> </a></h2><h3 id="Part-1:-import-the-UT-Zappos50k-database">Part 1: import the UT-Zappos50k database<a class="anchor-link" href="#Part-1:-import-the-UT-Zappos50k-database"> </a></h3><p>Using fastai <code>untar_data</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_zappos_db" class="doc_header"><code>get_zappos_db</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L19" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_zappos_db</code>()</p>
</blockquote>
<p>import the UT zappos 50k database from vision.cs.utexas.edu</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="data-set-cleaning">data set cleaning<a class="anchor-link" href="#data-set-cleaning"> </a></h3><p>The dataset is very diverse and not constructed in order to think about how popular footwear is aesthetically related.  I'm simplifying the database to include 4 categories which seem to split aesthetics for general footwear:</p>
<p>1) BOOTS - weatherized and/or protected footwear for work or outdoor activity
2) SANDALS - charachterized by a sole and straps
3) SHOES - generic non "boot" footwear.  includes heels and formalwear
4) SNEAKERS - atheletic / comfort inspired</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_zappos_meta" class="doc_header"><code>read_zappos_meta</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L33" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_zappos_meta</code>(<strong><code>path_meta</code></strong>)</p>
</blockquote>
<p>read the metadat from UT zappos 50k db</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">meta_path</span><span class="p">,</span> <span class="n">im_path</span> <span class="o">=</span> <span class="n">get_zappos_db</span><span class="p">()</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">meta_path</span><span class="o">==</span><span class="n">ZAPPOS_META_DIR</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">im_path</span><span class="o">==</span><span class="n">D_ROOT</span><span class="o">/</span><span class="n">DBS</span><span class="p">[</span><span class="s2">&quot;zappos&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">read_zappos_meta</span><span class="p">(</span><span class="n">meta_path</span><span class="p">)</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;SubCategory&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="simplify:">simplify:<a class="anchor-link" href="#simplify:"> </a></h3><p>Categories:</p>

<pre><code>1. SHOES, 
2. BOOTS, 
3. "SNEAKERS", and 
4. "SLIPPERS"</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>[[ TODO:  change the bullets to a short paragraph describing the simplificaiton ]]</p>
<p>Only include "adult" shoes</p>

<pre><code>- Adult = mens + womens (kids = not adults),+ etc (unisex)</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To construct these from the Zappos I needed to pull sneakers from shoes and exclude some sub-categories.  e.g. tall boots which would drive the representation of boots.</p>

<pre><code>BOOTS:
  BOOTS
    - ankle,  mid-calf
    - exclude: knee high , over the knee , prewalker

SANDALS:
  SANDALS
    - athletic, flat
    - exclude: heels 

SHOES:
  SHOES
    - Boat shoes, clogs and mules,  flats,  loafers, oxfords, prewalker
    - exclude: heels , crib shoes , firstwalker (exclude)

SNEAKERS
   SHOES
   - sneakers and athletic shoes

 SLIPPERS (exclude)</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="simplify_zappos_db" class="doc_header"><code>simplify_zappos_db</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>simplify_zappos_db</code>(<strong><code>df</code></strong>)</p>
</blockquote>
<p>simplifies the db (df)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">simplify_zappos_db</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prepare-the-simplified-dataframe-for-further-analysis">Prepare the simplified dataframe for further analysis<a class="anchor-link" href="#Prepare-the-simplified-dataframe-for-further-analysis"> </a></h2><p>Also use sklearn <code>train_test_split</code> to create category stratified train/test/validate groups.  We'll keep 15 percent of our data to truly test.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="skl_tt_split" class="doc_header"><code>skl_tt_split</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L124" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>skl_tt_split</code>(<strong><code>df</code></strong>, <strong><code>strat_cat</code></strong>)</p>
</blockquote>
<p>adds stratified train-validate-test via sklearn</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="pickle-the-dataframes">pickle the dataframes<a class="anchor-link" href="#pickle-the-dataframes"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="unpickle-the-dataframe">unpickle the dataframe<a class="anchor-link" href="#unpickle-the-dataframe"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;zappos-50k-simplified_sort&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-a-unfied-database-of-&quot;sneakers&quot;">Create a unfied database of "sneakers"<a class="anchor-link" href="#Create-a-unfied-database-of-&quot;sneakers&quot;"> </a></h2><ul>
<li>images (need to access) path to fit beta-VAE </li>
<li>descriptions for fitting text autoencoder</li>
<li>skip "meta" data (will come back to this later for further analysis.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="n">ZAPPOS_DF_SIMPLIFIED</span> <span class="c1">#&quot;zappos-50k-simplified_sort&quot;</span>
<span class="n">df_zappos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SCRAPED_META_DIR</span><span class="o">/</span><span class="n">SCRAPED_DF</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Path(&#39;/home/ergonyc/Projects/DATABASE/SnkrScrpr/data/full_data&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_scraped</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">SCRAPED_META_DIR</span><span class="o">/</span><span class="n">SCRAPED_DF</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>

<span class="c1"># load into pandas</span>
<span class="n">attributes</span> <span class="o">=</span> <span class="n">df_scraped</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span>
<span class="n">description</span> <span class="o">=</span> <span class="n">df_scraped</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">values</span>
<span class="n">df_scraped</span><span class="p">[[</span><span class="s1">&#39;url&#39;</span><span class="p">,</span><span class="s1">&#39;hero_fullpath&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>url</th>
      <th>hero_fullpath</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>https://www.goat.com/sneakers/air-jordan-11-retro-bred-2012-378037-010</td>
      <td>/Users/ergonyc/Projects/DATABASE/SnkrScrpr/data/goat/img/99543f4630.jpg</td>
    </tr>
    <tr>
      <th>1</th>
      <td>https://www.goat.com/sneakers/yeezy-boost-700-carbon-blue-yzy-700-what-the</td>
      <td>/Users/ergonyc/Projects/DATABASE/SnkrScrpr/data/goat/img/3fbd48e729.jpg</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I need to put the scraped databases from SNS (sneakersnstuff.com) and GOAT (goat.com) into a dataframe with columns suitable merge with the UTZappos database I originally started with.<br>
I'll spend some time infering the <code>Category</code>, <code>Brand</code>, <code>Gender</code> (and <code>model</code>?) so I can pay attention to class balance .  From the transfer learning work, the <code>Slippers</code> category is pretty poor, but I should be able to use that net to label the scraped data... and validate based on the <code>attributes</code> and <code>see_also</code> fields.</p>
<p>First things first:  fix the "hero_fullpath" so its agnostic of OS (Mac or Linux).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_scraped</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">df_scraped</span><span class="o">.</span><span class="n">hero_fullpath</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;scraped/&#39;</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">df_scraped</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span><span class="n">df_scraped</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(0    scraped/goat/99543f4630.jpg
 1    scraped/goat/3fbd48e729.jpg
 2    scraped/goat/6721456f62.jpg
 3    scraped/goat/27fbbaad00.jpg
 4    scraped/goat/df16a19226.jpg
 Name: path, dtype: object,
 1333    scraped/sns/eb4f3eada8.jpg
 1334    scraped/sns/5dace85f70.jpg
 1335    scraped/sns/2a18731113.jpg
 1336    scraped/sns/9cb275f3aa.jpg
 1337    scraped/sns/6d6c0b7b97.jpg
 Name: path, dtype: object)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_cat" class="doc_header"><code>extract_cat</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_cat</code>(<strong><code>lst</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_brand_goat" class="doc_header"><code>extract_brand_goat</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L164" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_brand_goat</code>(<strong><code>lst</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_brand_sns" class="doc_header"><code>extract_brand_sns</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L170" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_brand_sns</code>(<strong><code>lst</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_db_nm" class="doc_header"><code>extract_db_nm</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L173" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_db_nm</code>(<strong><code>pathn</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_scraped</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">df_scraped</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">extract_brand_sns</span><span class="p">)</span>
<span class="n">df_scraped</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">df_scraped</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">extract_cat</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_scraped</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
<span class="n">df_scraped</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;goat&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_scraped</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;db_name&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">df_scraped</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">extract_db_nm</span><span class="p">)</span>

<span class="n">df_scraped</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_scraped</span><span class="p">[</span><span class="s1">&#39;db_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;goat&#39;</span><span class="p">,</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">df_scraped</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_scraped</span><span class="p">[</span><span class="s1">&#39;db_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;goat&#39;</span><span class="p">,</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">extract_brand_goat</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_scraped_og</span> <span class="o">=</span> <span class="n">df_scraped</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we just need to wrap the above proceedure into a little function for exporting...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_scraped_db" class="doc_header"><code>get_scraped_db</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L178" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_scraped_db</code>()</p>
</blockquote>
<p>collect meta data fromscraped databases</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="merge_dbs" class="doc_header"><code>merge_dbs</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L209" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>merge_dbs</code>(<strong><code>df_zappos</code></strong>, <strong><code>df_scraped</code></strong>)</p>
</blockquote>
<p>could be any dfs with 'path','train','test','validate','t_t_v'</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">get_scraped_db</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># skl_tt_split defined in data.zappos</span>
<span class="n">df_scraped</span> <span class="o">=</span> <span class="n">skl_tt_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">db_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_zappos</span><span class="p">[</span><span class="s1">&#39;Sneakers&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0        False
1        False
2        False
3        False
4        False
         ...  
27609    False
27610    False
27611    False
27612    False
27613    False
Name: Sneakers, Length: 27614, dtype: bool</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_zap_sneakers" class="doc_header"><code>extract_zap_sneakers</code><a href="https://github.com/ergonyc/snkrfinder/tree/master/snkrfinder/data.py#L216" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_zap_sneakers</code>(<strong><code>df_zappos</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_zap</span> <span class="o">=</span> <span class="n">extract_zap_sneakers</span><span class="p">(</span><span class="n">df_zappos</span><span class="p">)</span>
<span class="n">df_zap</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(9434, 17)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_test</span> <span class="o">=</span> <span class="n">merge_dbs</span><span class="p">(</span><span class="n">df_zap</span><span class="p">,</span><span class="n">df_scraped</span><span class="p">)</span>

<span class="n">df_scraped</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">df_zappos</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">df_test</span><span class="o">.</span><span class="n">columns</span>

<span class="n">df_scraped</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">df_zappos</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">df_test</span><span class="o">.</span><span class="n">shape</span>

<span class="c1"># TODO:  check for duplicate paths before saving...</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((2337, 17), (27614, 17), (11771, 29))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_test</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">COMBINED_SNEAKERS_DF</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">))</span>


<span class="n">df_test2</span> <span class="o">=</span> <span class="n">merge_dbs</span><span class="p">(</span><span class="n">df_zappos</span><span class="p">,</span><span class="n">df_scraped</span><span class="p">)</span>
<span class="n">df_test2</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">COMBINED_DF</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
</div>
 

